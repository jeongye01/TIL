리액트의 렌더링은 브라우저가 렌더링에 필요한 DOM트리를 만드는 과정을 의미한다.

리액트 개발자라면 렌더링이 어떻게, 왜, 어떤 순서로 일어나는지 알고 있어야하며 이러한 렌더링 과정을 최소한으로 줄여야 한다.

# 리액트의 렌더링이란?

렌더링은 브라우저에서도 사용되는 용어이므로 두 가지를 혼동해서 사용해서는 안 된다.

리액트에서의 렌더링이란 리액트 어플리케이션 트리 안에 있는 모든 컴포넌트들이 현재 자신들이 가지고 있는 props와 state의 값을 기반으로 어떻게 UI를 구성하고 이를 바탕으로 어떤 DOM 결과를 브라우저에 제공할 것인지 계산하는 일련의 과정을 의미한다. 

# 리액트 렌더링 시나리오

1. 최초 렌더링 : 사용자가 처음 어플리케이션에 진입하면 당연히 렌더링 해야할 결과물이 필요하다. 리액트는 브라우저에 이 정보를 제공하기 위해 최초 렌더링을 수행한다.
2. 리렌더링 : 리렌더링은 처음 어플리케이션에 진입했을 때 최초 렌더링이 발생한 이후로 발생하는 모든 렌더링을 의미한다. 리렌더링이 발생하는 경우는 다음과 같다.
    1. setState가 실행되는 경우 → state 변화
    2. forceUpdate가 실행되는 경우
    3. useReducer의 두번째 배열 요소인 dispatch가 실행되는 경우 
    4. 컴포넌트의 key props가 변경되는 경우
    5. props가 변경되는 경우
    6. 부모 컴포넌트가 렌더링될경우 : 부모 컴포넌트가 리렌더링 된다면 자식 컴포넌트도 무조건 리렌더링이 일어난다. 
    

# 리액트 렌더링 프로세스

렌더링 프로세스가 시작되면 리액트는 컴포넌트의 루트에서부터 차근차근 아래쪽으로 내려가면서 업데이트가 필요하다고 지정돼 있는 모든 컴포넌트를 찾는다 . 

JSX는 자바스크립트로 컴파일 되면서 React.createElement()를 호출하는 구문으로 변환된다. 여기서 createElement는 브라우저의 구조를 설명할 수 있는 일반적인 자바스크립트 객체를 반환한다.

### 예시

```jsx
function Hello(){
  return (
     <TestComponent a={35} b="yceffort">
       안녕하세요
     </TestComponent>
  )
}
```

```jsx
function Hello(){
  return React.createElement(
    TestComponent,
    {a:35,b:'yceffort'}
    '안녕하세요'
  )
}
```

결과물은 다음과 같다

```jsx
{type:TestComponent,props:{a:35,b:'yceffort',children:"안녕하세요"}}
```

렌더링 프로세스가 실행되면서 이런 과정을 거쳐 각 컴포넌트의 렌더링 결과물을 수집한 다음, 리액트의 새로운 트리인 가상 DOM과 비교해 실제 DOM에 반영하기 위한 모든 변경 사항을 차례차례 수집한다.

이렇게 계산하는 과정을 바로 리액트의 재조정이라고 한다. 이러한 재조정 과정이 모두 끝나면 모든 변경사항을 하나의 동기 시퀀스로 DOM에 적용해 변경된 결과물이 보이게 한다.

한 가지 주목해야 할 것은 리액트의 렌더링은 렌더 단계와 커밋 단계라는 총 두 단계로 분리되어 실행된다는 것이다. 

# 렌더와 커밋

렌더 단계는 컴포넌트를 렌더링하고 변경 사항을 계산하는 모든 작업을 말한다.

즉 렌더링 프로세스에서 컴포넌트를 실행해(render() 또는 return) 이 결과와 이전 가상 DOM을 비교하는 과정을 거쳐 변경이 필요한 컴포넌트를 체크하는 단계다. 여기서 비교하는 것은 크게 세가지로, type, props, key다. 이 세가지 중 하나라도 변경된 것이 있으면 변경이 필요한 컴포넌트로 체크해둔다.

커밋단계는 렌더 단계의 변경 사항을 실제 dom에 적용해 사용자에게 보여주는 과정을 말한다. 이 단계가 끝나야 비로소 브라우저의 렌더링이 발생한다.

리액트의 렌더링이 일어난다고 해서 무조건 dom 업데이트가 일어나는것은 아니다. 렌더링을 수행했으니 커밋 단계까지 갈 필요가 없다면, 즉 변경 사항을 계산했는데 아무런 변경 사항이 감지되지 않는다면 이 커밋 단계는 생략 될 수 있다. 

렌더링 과정 중 첫 번째 단계인 렌더 단계에서 변경사항을 감지할 수 없다면 커밋 단계가 생략되어 브라우저의 DOM 업데이트가 일어나지  않을 수 있다. 

# 일반적인 렌더링 시나리오

1. B컴포넌트의 setState가 호출된다.
2. B 컴포넌트의 리렌더링 작업이 렌더링 큐에 들어간다.
3. 리액트는 트리 최상단에서부터 렌더링 경로를 검사한다.
4. A 컴포넌트는 리렌더링이 필요한 컴포넌트로 표시돼 있지 않으므로 별다른 작업을 하지 않는다.
5. 그 다음 하위 컴포넌트인 B 컴포넌트는 업데이트가 피룡하다고 체크돼 있으므로 B를 리렌더링한다.
6. 5번과정에서 B는 C를 반환했다
7. C는 props인 number가 업데이트됐다. 그러므로 업데이트가 필요한 컴포넌트로 체크돼 있고 업데이트한다.
8. 7번 과정에서 C는 D를 반환했다
9. D도 마찬가지로 업데이트가 필요한 컴포넌트로 체크되지 않았다. 그러나 C가 렌더링 됐으므로 그 자식인 D도 렌더링됐다.
