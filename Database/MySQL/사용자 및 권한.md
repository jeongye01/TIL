# 사용자 식별

- MySQL의 사용자는 다른 DBMS와는 조금 다르게 사용자의 계정뿐 아니라 사용자의 접속지점(클라이언트가 실행된 호스트명이나 도메인 또는 IP)도 계정의 일부가 된다.

### 1. 사용자 계정의 구성

MySQL에서는 **사용자명 + 호스트명**으로 사용자를 구분합니다.

```sql
'username'@'host'
```

- `'username'` : MySQL 사용자 이름
- `'host'` : 클라이언트 접속 호스
    - `%` : 모든 호스트 허용
    - `localhost` : 서버 로컬 접속만 허용
    - 특정 IP나 도메인 가능 (`'user'@'192.168.0.100'`)

**예시**

- `'alice'@'localhost'` → 로컬에서만 접속 가능
- `'bob'@'%'` → 모든 호스트에서 접속 가능
- `'admin'@'192.168.0.10'` → 특정 서버에서만 접속 가능

---

### 2. 실제 접속 시 식별 절차

1. 클라이언트가 `username`, `password`, `host` 정보로 접속 시도
2. MySQL은 `mysql.user` 테이블에서
    
    **`username` + `host`가 일치하는 계정**을 탐색
    
3. 비밀번호 인증
4. 성공하면 해당 계정의 권한(Privileges) 적용

# 사용자 계정 관리

- 시스템 계정(System Account)
    - 데이터베이스 서버 관리자를 위한 계정. 일반 계정은 시스템 계정을 관리 할 수 없다.
    - 계정 관리(계정 생성 및 삭제, 그리고 계정의 권한 부여 및 제거)
    - 다른 세션(Connection) 또는 그 세션에서 실행 중인 쿼리를 강제 종료
    - 스토어드 프로그램 생성 시 DEFINER를 타 사용자로 설정
- 일반 계정(Regular Account)
    - 응용 프로그램이나 개발자를 위한 계정

## MySQL 서버 내장 계정

### 1. `root@localhost`

- **최고 관리자 계정**
- 설치 시 자동 생성됨
- 모든 권한(`ALL PRIVILEGES`)을 가짐
- 기본적으로 원격 접속은 불가 → `localhost`에만 제한
- 사용자가 직접 비밀번호를 설정해야 함

---

### 2. `mysql.sys@localhost`

- MySQL 8.0 기본으로 내장된 sys 스키마의 객체 (뷰나 함수, 그리고 프로시저)들의 DEFINER로 사용되는 계정
- account_locked = Y

---

### 3. `mysql.session@localhost`

- MySQL 플러그인이 서버로 접근할 때 사용 되는 계정
- account_locked = Y

---

### 4. `mysql.infoschema@localhost`

- `INFORMATION_SCHEMA` 에 정의된 뷰의 DEFINER로 사용되는 계정
- account_locked = Y

# 계정 생성

- 계정 생성 옵션들
    - 계정의 인증 방식과 비밀번호
    - 비밀번호 관련 옵션(비밀번호 유효 기간, 비밀번호 이력 개수, 비밀번호 재사용 불가 기간)
    - 기본 역할(Role)
    - SSL 옵션
    - 계정 잠금 여부
    
    ```sql
    CREATE USER 'user'@'%'
    -- 사용자의 인증방식과 비밀번호 설정
    -- MySQL 8.0 부터 기본값으로 Caching SHA-2 Authentication 인증방식 사용(SSL  옵션 활성화 필요)
    IDENTIFIED WITH 'mysql_native_password' BY 'password'
    -- MySQL 서버에 접속할 때 암호화된 SSL/TLS 채널을 사용할지 여부
    REQUIRE NONE
    -- 비밀번호 유효 기간 설정관련
    PASSWORD EXPIRE INTERVAL 30 DAY
    -- 계정 잠금 여부
    ACCOUNT UNLOCK
    -- 한 번 사용했던 비밀번호를 재사용하지 못하게 설정 옵션
    PASSWORD HISTORY DEFAULT
    -- 한번 사용했던 비밀번호의 재사용 금지 기간 설정 옵션
    PASSWORD REUSE INTERVAL DEFAULT
    -- 비밀번호가 만료되어 새로운 비밀번호로 변경할 때 현재 비밀번호를 필요로 할지 말지
    PASSWORD REQUIRE CURRENT DEFAULT;
    ```
    

# 비밀번호 관리

- validate_password 컴포넌트
    - 비밀번호 유효성 체크 규칙 적용
    - LOW: 비밀번호 길이만 검증
    - MEDIUM: 비밀번호의 길이를 검증하며, 숫자와 대소문자, 그리고 특수문자의 배합을 검증
    - STRONG: MEDIUM 레벨의 검증을 모두 수행하며, 금칙어가 포함됐는지 여부까지 검증
- 이중 비밀번호
    - 서비스에서 데이터베이스 계정의 비밀번호는 처음 설정한 상태로 몇 년 동안 사용되는 경우가 많다.(서비스를 멈춰야 하므로) 이를 보완하기 위해 이중 비밀번호를 설정할 수 있다.
    - 세컨더리 비밀번호가 삭제되면 기존 비밀번호로는 로그인이 불가능하며, 새로운 비밀번호로만 로그인 할 수 있게 된다.

# 권한(Privilege)

MySQL의 privilege(권한)는 사용자가 데이터베이스에서 수행할 수 있는 작업을 제어하는 보안 메커니즘입니다.

## 주요 권한 유형

**글로벌 권한**

- `ALL PRIVILEGES`: 모든 권한
- `CREATE USER`: 사용자 생성/삭제
- `RELOAD`: 권한 테이블 새로고침
- `SHUTDOWN`: 서버 종료
- `PROCESS`: 실행 중인 프로세스 조회

**데이터베이스 레벨 권한**

- `CREATE`: 데이터베이스/테이블 생성
- `DROP`: 데이터베이스/테이블 삭제
- `ALTER`: 테이블 구조 변경
- `INDEX`: 인덱스 생성/삭제

**테이블 레벨 권한**

- `SELECT`: 데이터 조회
- `INSERT`: 데이터 삽입
- `UPDATE`: 데이터 수정
- `DELETE`: 데이터 삭제

**컬럼 레벨 권한**

- 특정 컬럼에만 SELECT, INSERT, UPDATE 권한 부여 가능

## 권한 관리 명령어

**권한 부여**

```sql
*-- 특정 데이터베이스에 모든 권한 부여*
GRANT ALL PRIVILEGES ON database_name.* TO 'username'@'hostname';
*-- 특정 테이블에 SELECT 권한만 부여*
GRANT SELECT ON database_name.table_name TO 'username'@'hostname';
*-- 특정 컬럼에만 권한 부여*
GRANT SELECT (column1, column2) ON table_name TO 'username'@'hostname';
```

**권한 확인**

```sql
*-- 현재 사용자 권한 확인*
SHOW GRANTS;
*-- 특정 사용자 권한 확인*
SHOW GRANTS FOR 'username'@'hostname';
```

**권한 회수**

```sql
*-- 권한 제거*
REVOKE SELECT ON database_name.* FROM 'username'@'hostname';
*-- 모든 권한 제거*
REVOKE ALL PRIVILEGES ON *.* FROM 'username'@'hostname';
```

**권한 적용**

```sql
*-- 변경된 권한 즉시 적용*
FLUSH PRIVILEGES;
```

## 권한 범위

1. **글로벌 레벨**: 서버 전체에 적용
2. **데이터베이스 레벨**: 특정 데이터베이스에 적용
3. **테이블 레벨**: 특정 테이블에 적용
4. **컬럼 레벨**: 특정 컬럼에 적용

# 역할(Role)

- 여러 개의 Privilege(권한)를 묶어서 한꺼번에 관리하는 그룹

```sql
CREATE ROLE role_emp_read,role_emp_write;
```

```sql
GRANT SELECT ON employees.* TO role_emp_read;
GRANT INSERT, UPDATE, DELETE ON employees.* TO role_emp_write;
```

```sql
CREATE USER reader@'127.0.0.1' IDENTIFIED BY 'qwerty';
CREATE USER writer@'127.0.0.1' IDENTIFIED BY 'qwerty';
```

```sql
GRANT role_emp_read TO reader@'127.0.0.1';
GRANT role_emp_read, role_emp_write TO writer@'127.0.0.1';
```

```sql
-- ROLE 활성화
SET ROLE 'role_emp_read';
```
