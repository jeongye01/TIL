디스크가 동작하는 것은 매우 느리므로 오라클은 캐시(Shared Memory 위에 Buffer Cache)를 통해 가능한 한 디스크에서 처리하지 않고, 메모리에서 처리하는 구조를 가지고 있음. 

# DataBlock

오라클을  DataBlock 단위로 데이터를 관리한다. I/O 단위가 블록을 기반으로 하며, 버퍼 캐시도 블록 단위로 관리되고 있음.

<img width="412" alt="image" src="https://github.com/jeongye01/TIL/assets/74299317/9526288e-b551-4ec7-91a1-996f967cbacc">


블록 크기는 2KB,4KB,8KB,16KB,32KB 중에서 선택할 수 있음.

# 공유 메모리(Shared Memory)

OS에서 다른 프로세스의 메모리를 보는 것은 기본적으로 불가능 하지만 DBMS의 특성으로 인해 OS는 공유 메모리(SGA(System Global Area)라고도 불린다.)라는 특수한 메모리 기능을 제공한다. 

이 공유 메모리에는 누구든지 접근을 할 수 있으므로 Lock을 걸어 배타적 제어가 필요하다.(Exclusive Control)

### 공유 메모리 설정

공유메모리에는 버퍼 캐시, 공유 풀, 로그 버퍼 등의 영역들이 존재 함 

*spfileXXXX.ora (XXXX는 데이터베이스 식별 ID) : 오라클 설정 파일

**파라미터**

- DB_CACHE_SIZE : 버퍼 캐시의 크기를 결정. 성능과 직결되기 때문에 신중히 결정해야함. 자동 공유 메모리(버퍼 캐시 크기를 오라클이 알아서 관리)를 설정한 상태로 DB_CACHE_SIZE를 설정하면 하한값으로서 동작하므로 혹여라도 버퍼 캐시의 영역이 다른 영역에 잡아먹혀서 성능이 나빠지는 상황을 방지할 수 있음

# LRU 알고리즘 - 버퍼 캐시 정리

버퍼 캐시의 크기는 한정되어 있으므로 관리하고 정리해야 함.

이를 위해 일반적으로 알려진 것이 LRU 알고리즘(Least Recently Used) 이다.

최근에 사용하지 않은 데이터 부터 캐시 아웃 시킨다.

만약 데이터가 많은 테이블을 풀 스캔한 데이터를 버퍼 캐시에 적재해둘 경우 자주 사용하는 데이터를 캐시에서 쫓아내는 일이 발생할 수 있으므로 오라클은 큰 테이블이라고 판단하면 버퍼 캐시로 블록을 적재하지 않는다. (풀 스캔 했을때의 데이터는 일반적으로 버퍼캐시에 적재 하지 않는다.)

### DBWR

기본적으로 서버 프로세스는 디스크에서 데이터를 읽어오기는 하지만 디스크에 기록은 하지 않는다.  백그라운드 프로세스인 DBWR이 해당 작업을 수행한다. 이때 변경된 데이터가 디스크에 기록되기 전에 캐시에서 버려지면 데이터가 손실되므로, 캐시에서 버려지기 전에(가능하면 정기적으로) 디스크에 기록해둘 필요가 있다.
