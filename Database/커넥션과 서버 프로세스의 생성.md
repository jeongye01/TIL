# 리스너(listener)

오라클을 사용하는 클라이언트가 같은 서버 위에 있는 경우는 드물며,

오라클은 TCP/IP의 socket을 네트워크 통신 수단으로 사용하고 있다.

 

<img width="494" alt="image" src="https://github.com/jeongye01/TIL/assets/74299317/164887fc-1eb3-4a86-8b61-e7fbd2c2b897">


오라클에서는 수신을 기다리는 프로세스를 listener라고 부른다.(서버 프로세스는 아님)

# 커넥션 처리

### 1. 리스너 기동

<img width="516" alt="image" src="https://github.com/jeongye01/TIL/assets/74299317/e23f4823-289f-4af8-8d84-83d7133655d0">


오라클은 기본적으로 리스터의 포트 번호를 1521을 사용한다. 리스너가 자신이 안내해야 하는 데이터베이스를 인식하는 방법으로는 listener.ora 파일에 기록되어 있는 설정을 읽거나, 데이터베이스가 자동으로 등록하는 방법이 있음. 일반적으로는 사용이 간단한 자동 등록을 선택해서 사용한다.

### 2. 애플리케이션에서의 커넥션

데이터 베이스에 연결할때 필요한 정보를 오라클 클라이언트에 전달할 필요가 있으며, 그 정보를 커넥션 디스크립터(connection descriptor)라고 부른다. 이 안에는 ‘주소는 XXX이며, 포트가 XXX이고, 서비스 이름이 XXXX…’ 같은 정보가 포함되어 있다. 연결할때마다 정보를 입력할 수는 없으므로, 일반적으로  tnsnames.ora에 커넥션 디스크립터를 작성해놓고 커넥션 식별자(별칭)를 커넥션 디스크립터마다 붙인다.

그래서 연결할때는 해당 커넥션 식별자를 오라클 클라이언트에 전달하기만 하면 된다.

일반적으로 오라클 클라이너트는 tnsnames.ora의 커넥션 디스크립터 정보를 사용해서 리스너와 클라이언트 사이에 소켓을 생성하고, 리스너에게 연락한다.

### 3. 서버 프로세스의 생성

마지막 과정은 서버 프로세스를 생성하고 소켓을 인계받는 것이다. 

먼저 OS상에서 프로세스를 생성해야 하며(일반적으로도 프로세스를 생성하는 것은 처리가 무겁다고 알려져 있다), 서버 프로세스가 사용할 수 있는 공유 메모리를 확보해야 한다. 또한, 서버 프로세스용 전용 메모리(PGA)도 확보해야 한다. 

따라서 서버 프로세스를 한번 생성하는데는 가벼운 SQL문을 처리할 때 사용하는 CPU 시간보다 몇배에서 몇십  배 많은 CPU 시간을 사용한다. 

리스너는 서버 프로세스 생성이 끝나면 소켓을 서버 프로세스에 인계한다. 리스너가 인계한 후부터 서버 프로세스와 오라클 클라이언트는 직접 송수신 하므로 리스너는 자유로워 진다. 

 

### 성능 개선

커넥션을 맺는 것과 서버 프로세스를 생성하는 것은 무거운 작업이므로 커넥션 풀을 통해 성능 개선을 할 수 있다. → 서버 프로세스 몇개를 풀로 구성해두고 여러 어플리케이션이 자신이 쓰고 싶을 때만 풀에서 하나를 꺼내 사용한다.
