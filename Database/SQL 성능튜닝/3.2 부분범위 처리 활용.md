# 부분 범위 처리

1억건짜리 테이블에도 결과를 빨리 출력할 수 있는 이유는, DBMS가 데이터를 모두 읽어 한 번에 전송하지 않고 먼저 읽는 데이터부터 일정량을 전송하고 멈추기 때문이다. 데이터를 전송하고 나면 서버 프로세스는 CPU를 OS에 반환하고 대기 큐에서 잠을 잔다. 다음 Fetch Call을 받으면 대기 큐에서 나와 그 다음 데이터부터 일정량을 읽어서 전송하고 또다시 잠을 잔다. 

이처럼 전체 쿼리 결과집합을 쉼없이 연속적으로 전송하지 않고 사용자로부터 Fetch Call이 있을때마다 일정량씩 나누어 전송하는 것을 부분범위 처리라고 한다. 

데이터를 전송하는 단위인 ArraySize는 클라이언트 프로그램에서 설정한다. JAVA에서 Array Size 기본값은 10이며 Statement 객체 setFetchSize 메소드를 통해 설정을 변경할 수 있다.

### Array Size가 10인 상태에서 JAVA 프록램이 데이터를 읽어들이는 메커니즘

1. 최초 rs.next() 호출 시 Fetch Call을 통해 DB 서버로부터 전송받은 데이터 10건을 클라이언트 캐시에 저장한다.
2. 이후 rs.next() 호출할때는 Fetch Call을 발생시키지 않고 캐시에서 데이터를 읽는다.
3. 캐시에 저장한 데이터를 모두 소진한 상태에서 rs.next() 호출 시 추가 Fetch Call을 통해 10건을 전송받는다.
4. 100건을 다 읽을 때까지 2~3 번 과정을 반복한다. 

### 정렬 조건이 있을때 부분범위 처리

만약 쿼리문에 order by가 있다면 DB서버는 모든 데이터를 다 읽어 정렬을 마치고서야 클라이언트에게 데이터를 전송할수 있다. 전체범위처리다. 만약 인덱스를 통해 정렬연산이 생략이 된다면 부분범위처리가 가능할 수 있다.

# OLTP 환경에서 부분범위 처리에 의한 성능개선 원리

다행히 OLTP성 업무에서 쿼리 결과 집합이 아주 많을 때 사용자가 모든 데이터를 일일이 다 확인하지는 않는다. 특정한 정렬 순서로 상위 일부 데이터만 확인한다. 은행계좌 입출금 조회, 뉴스또는 게시판 조회 등이 여기에 해당하며, 주로 목록을 조회하는 경우아.그럴때, 항상 정렬 상태를 유지하는 인덱스를 이용하면, 정렬 작업을 생략하고 앞쪽 일부 데이터를 아주 빠르게 보여줄수 있다. 

인덱스와 부분범위 처리 원리를 잘 활용하면 OLTP 환경에서 극적인 성능개선 효과를 얻을 수 있다.
