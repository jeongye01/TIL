# SQL 파싱과 최적화

## 구조적,집합적, 구조적 질의 언어

```sql
SELECT E.EMPNO, E.ENAME, E.JOB, D.DNAME, D.LOC
FROM EMP E, DEPT D
WHERE E.DEPNO = D.DEPNO
ORDER BY E.ENAME
```

SQL은 Structured Query Language의 줄임말이다.  SQL은 기본적으로 구조적이고 집합적이고 선언적인 질의 언어다.

사용자가 SQL을 작성하면 옵티마이저가 실행 계획을 세우고 프로시저를 만들어낸다.

DBMS 내부에서 프로시저를 작성하고 컴파일해서 실행 가능한 상태로 만드는 전 과정을 SQL 최적화라고 한다.

## SQL 최적화

SQL을 실행하기 전 최적화 과정을 세분화하면 아래와 같다.

1. SQL 파싱
    1. 파싱 트리 생성
    2. Syntax 체크
    3. Semantic 체크
2. SQL 최적화
    
    SQL 옵티마이저는 미리 수집한 시스템 및 오브젝트 통계정보를 바탕으로 다양한 실행경로를 생성해서 비교한 후 가장 효율적인 하나를 선택한다. 데이터베이스 성능을 결정하는 가장 핵심적인 엔진이다. 
    
3. 로우 소스 생성
    
    SQL 옵티마이저가 선택한 실행경로를 실제 실행 가능한 코드 또는 프로시터 형태로 포맷팅하는 단계다. 로우 소스 생성기가 그 역할을 맡는다.
    

## SQL 옵티마이저

옵티마이저의 최적화 단계를 요약하면 아래와 같다.

1. 사용자로부터 전달받은 쿼리를 수행하는데 후보군일 될만한 실행계획들을 찾아낸다
2. 데이터 딕셔너리에 미리 수집해둔 오브젝트 통계 및 시스템 통계정보를 이용해 각 실행 계획의 예상 비용을 산정한다.
3. 최저 비용을 나타내는 실행계획을 선택한다.

# 실행계획과 비용

실행계획(Execution Plan) : SQL 옵티마이저가 생성한 처리절차를 사용자가 확인할 수 있게 트리 구조로 표현한 것. 미리보기 기능을 통해 자신이 작성한 SQL이 테이블을 스캔하는지 인덱스를 스캔하는지, 인덱스를 스캔한다면 어떤 인덱스인지를 확인할 수 있고, 예상과 다른 방식으로 처리된다면 실행경로를 변경할 수 있다.

비용(cost):쿼리를 수행하는 동안 발생할 것으로 예상하는 I/O 횟수 또는 예상 소요시간을 표현한 값.실측치가 아니므로 실제 수행할때 발생하는 I/O 또는 시간과 많은 차이가 난다.

## 옵티마이저 힌트

SQL 옵티마이저는 대부분 좋은 선택을 하지만, 완벽하진 않다. SQL 이 복잡할수록 실수할 가능성도 크다. 통계정보에 답을 수 없는 데이터 또는 업무 특성을 활용해 개발자가 직접 더 효율적인 엑세스 경로를 찾아낼 수도 있다. 이럴때 옵티마이저 힌트를 이용해 데이터 엑세스 경로를 바꿀 수 있다. 

힌트를 사용하기 위해 주석 기호에 `+`를 붙이면 된다.

```sql
SELECT /*+ INDEX(A 고객_PK) */
        고객명, 연락처, 주소, 가입일시
FROM 고객 A
WHERE 고객ID = '0000000008'
```
