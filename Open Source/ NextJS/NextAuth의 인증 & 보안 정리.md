## 1ï¸âƒ£ ë¡œê·¸ì¸ ë°©ì‹

- ì›¬ë§Œí•œ ë¡œê·¸ì¸ì€ ì „ë¶€ ì§€ì›
    
    â†’ **OAuth**, **ìì‚¬ ê³„ì • ë¡œê·¸ì¸(Credentials)**, **Magic Link (ë¹„ë°€ë²ˆí˜¸ ì—†ëŠ” ë¡œê·¸ì¸)**
    

---

## 2ï¸âƒ£ ë³´ì•ˆ í•µì‹¬ ìš”ì•½

### ğŸ” **Secure Cookies**

- **httpOnly**: JSë¡œ ì ‘ê·¼ ë¶ˆê°€ â†’ XSS ë°©ì§€
- **Secure**: HTTPSì—ì„œë§Œ ì „ì†¡
- **Signed**: ì„œë²„ê°€ ì„œëª… â†’ ì¡°ì‘ ë°©ì§€
- **SameSite**: CSRF ì™„í™”
- **Prefix (`__Secure-`, `__Host-`)**: ë¸Œë¼ìš°ì €ê°€ ê°•ì œ ë³´ì•ˆ ê·œì¹™ ì ìš©
    - `__Secure-`: HTTPS í•„ìˆ˜
    - `__Host-`: HTTPS + Path=/ + Domain ê¸ˆì§€ (Domain ì„ ì“°ë©´ ëª¨ë“  í•˜ìœ„ ì„œë¸Œë„ë©”ì¸ë„ ì¿ í‚¤ ì „ì†¡ì´ í—ˆìš©ëŒ)

> âœ… ê²°ë¡ : í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” __Host- í”„ë¦¬í”½ìŠ¤ ì‚¬ìš©ì´ ìµœì .
> 

---

### ğŸ§¾ **Signed Cookie (ì¿ í‚¤ ì„œëª…)**

- ì¿ í‚¤ ê°’ì— **ì„œëª…(HMAC)** ì„ ì¶”ê°€í•´ì„œ ì¡°ì‘ ê°ì§€.
- ì›ë³¸ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ì„œëª…í–ˆì„ ë•Œ ê¸°ëŒ€ê°’ê³¼ ë‹¤ë¥´ë©´ ìœ„ì¡°ë¡œ íŒë‹¨.

> sessionId=abc123.signature
> 

---

### ğŸ›¡ï¸ **CSRF ë°©ì–´**

- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë“±ì€ **POST ìš”ì²­ + CSRF í† í° ê²€ì¦**ìœ¼ë¡œ ë³´í˜¸.
- ì„œë²„ëŠ” ì¿ í‚¤ì™€ ìš”ì²­ body/headerì˜ `csrfToken` ê°’ì´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸.

| ë©”ì„œë“œ | ìš©ë„ |
| --- | --- |
| GET | ì¡°íšŒ ì „ìš© |
| POST | ìƒíƒœ ë³€ê²½ |

---

### ğŸ”‘ **JWT / JWS / JWE / JWK**

- **JWT**: ì¸ì¦ ì •ë³´ë¥¼ ë‹´ì€ í† í°
- **JWS**: ì„œëª… â†’ ìœ„ì¡° ë°©ì§€
- **JWE**: ì•”í˜¸í™” â†’ ë‚´ìš© ë³´í˜¸
- **JWK**: ê³µê°œí‚¤ ì„¸íŠ¸ (JWT ê²€ì¦ìš©)

> OAuth ì„œë¹„ìŠ¤ê°€ private keyë¡œ ì„œëª…í•œ JWTë¥¼,
> 
> 
> í´ë¼ì´ì–¸íŠ¸ëŠ” ê³µê°œëœ JWK(public key)ë¡œ ê²€ì¦í•¨.
> 

---

### ğŸ” **Tab Syncing / Auto Revalidation / Keepalive**

| ê¸°ëŠ¥ | ì„¤ëª… |
| --- | --- |
| **Tab Syncing** | í•œ íƒ­ ë¡œê·¸ì¸ ì‹œ, ë‹¤ë¥¸ íƒ­ë„ ìë™ ë°˜ì˜ (`localStorage` ì´ë²¤íŠ¸) |
| **Auto Revalidation** | ì„¸ì…˜ ë§Œë£Œ ì‹œ ìë™ ì¬ê²€ì¦ (ìœ ë ¹ ì„¸ì…˜ ë°©ì§€) |
| **Keepalive** | â€œë‚˜ ì•„ì§ ì‚´ì•„ìˆë‹¤â€ ping â†’ ì„¸ì…˜ ë§Œë£Œ ë°©ì§€ |

> UXëŠ” ë§¤ë„ëŸ½ê²Œ, ì„¸ì…˜ì€ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€.
> 

---

### ğŸ§  **ì„œë²„ ì£¼ë„ ì¸ì¦ (Doesn't rely on client JS)**

- ì¸ì¦ ê²€ì¦ì€ **ì„œë²„ì—ì„œ ìˆ˜í–‰**
- í´ë¼ì´ì–¸íŠ¸ ì¡°ì‘(XSS ë“±)ìœ¼ë¡œ ì„¸ì…˜ ìœ„ì¡° ë¶ˆê°€
- `getServerSession()`ìœ¼ë¡œ ì„œë²„ ë Œë”ë§ ì‹œ ì„¸ì…˜ ì§ì ‘ í™•ì¸ ê°€ëŠ¥

```tsx
const session = await getServerSession(authOptions);
if (!session) redirect("/login");
```

### ê³µì‹ ë¬¸ì„œ ë§í¬
https://next-auth.js.org/getting-started/introduction
